version: 2.1

jobs:
    build:
        docker:
            - image: "debian:stretch"

        steps:
            - run:
                name: Updating
                command: apt-get update
            - run:
                name: Installing tools
                command: |
                    wget https://cmake.org/files/v3.10/cmake-3.10.2-Linux-x86_64.tar.gz
                    tar -xvzf cmake-3.10.2-Linux-x86_64.tar.gz
                    chmod +x ./cmake-3.10.2-Linux-x86_64/bin/ccmake
                    chmod +x ./cmake-3.10.2-Linux-x86_64/bin/cmake
                    chmod +x ./cmake-3.10.2-Linux-x86_64/bin/cpack
                    chmod +x ./cmake-3.10.2-Linux-x86_64/bin/ctest
                    DIR=$(pwd)
                    ln -s $DIR/cmake-3.10.2-Linux-x86_64/bin/ccmake /usr/bin/ccmake
                    ln -s $DIR/cmake-3.10.2-Linux-x86_64/bin/cmake /usr/bin/cmake
                    ln -s $DIR/cmake-3.10.2-Linux-x86_64/bin/cpack /usr/bin/cpack
                    ln -s $DIR/cmake-3.10.2-Linux-x86_64/bin/ctest /usr/bin/ctest
                    apt-get install -y gcc g++ ninja-build git openssh-client
            - checkout
            - run:
                name: Pulling submodules
                command: git submodule sync && git submodule update --init
            - run:
                name: Build
                command: make tests
            - run:
                name: Unit tests
                command: make run_tests